<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NBA Player Stats Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>NBA Player Stats Dashboard</h1>
  <p>Explore NBA player performance: compare Points Per Game (PPG) vs Field Goal Percentage (FG%), and see team averages below.</p>

  <div id="controls">
    <label for="teamSelect">Filter by Team:</label>
    <select id="teamSelect">
      <option value="All">All Teams</option>
    </select>
    <button id="resetBtn">Reset</button>
  </div>

  <!-- Bubble Chart -->
  <svg id="bubbleChart" width="950" height="500"></svg>

  <!-- Bar Chart -->
  <svg id="barChart" width="950" height="350"></svg>

  <script>
    const color = d3.scaleOrdinal(d3.schemeTableau10);

    // Tooltip
    const tooltip = d3.select("body")
      .append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // Load Data
    d3.csv("nba_data.csv").then(data => {
      data.forEach(d => {
        d.PPG = +d.PPG;
        d.APG = +d.APG;
        d.FGP = +d.FGP;
      });

      const teams = [...new Set(data.map(d => d.Team))];
      teams.forEach(team => {
        d3.select("#teamSelect").append("option").attr("value", team).text(team);
      });

      // ---------------- BUBBLE CHART ----------------
      const margin = {top: 40, right: 40, bottom: 60, left: 70};
      const width = 950 - margin.left - margin.right;
      const height = 500 - margin.top - margin.bottom;

      const svg1 = d3.select("#bubbleChart")
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      const xScale = d3.scaleLinear()
        .domain([d3.min(data, d => d.PPG) - 2, d3.max(data, d => d.PPG) + 2])
        .range([0, width]);

      const yScale = d3.scaleLinear()
        .domain([d3.min(data, d => d.FGP) - 0.05, d3.max(data, d => d.FGP) + 0.05])
        .range([height, 0]);

      svg1.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(xScale));

      svg1.append("g").call(d3.axisLeft(yScale).tickFormat(d3.format(".0%")));

      svg1.append("text")
        .attr("x", width / 2)
        .attr("y", height + 45)
        .attr("text-anchor", "middle")
        .attr("class", "axis-label")
        .text("Points Per Game (PPG)");

      svg1.append("text")
        .attr("transform", "rotate(-90)")
        .attr("x", -height / 2)
        .attr("y", -45)
        .attr("text-anchor", "middle")
        .attr("class", "axis-label")
        .text("Field Goal Percentage (FG%)");

      let bubbles = svg1.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", d => xScale(d.PPG))
        .attr("cy", d => yScale(d.FGP))
        .attr("r", d => d.APG * 1.5)
        .attr("fill", d => color(d.Team))
        .attr("opacity", 0.8)
        .on("mouseover", (event, d) => {
          tooltip.transition().duration(200).style("opacity", 1);
          tooltip.html(`<strong>${d.Player}</strong><br>
                        Team: ${d.Team}<br>
                        PPG: ${d.PPG}<br>
                        FG%: ${(d.FGP * 100).toFixed(1)}%<br>
                        APG: ${d.APG}`)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", () => tooltip.transition().duration(400).style("opacity", 0));

      // ---------------- BAR CHART ----------------
      const svg2 = d3.select("#barChart")
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      const xBar = d3.scaleBand()
        .range([0, width])
        .padding(0.3);

      const yBar = d3.scaleLinear()
        .range([height / 1.5, 0]);

      const xAxisBar = svg2.append("g")
        .attr("transform", `translate(0,${height / 1.5})`);

      const yAxisBar = svg2.append("g");

      svg2.append("text")
        .attr("x", width / 2)
        .attr("y", height / 1.5 + 50)
        .attr("text-anchor", "middle")
        .attr("class", "axis-label")
        .text("Teams");

      svg2.append("text")
        .attr("x", -height / 4)
        .attr("y", -45)
        .attr("transform", "rotate(-90)")
        .attr("text-anchor", "middle")
        .attr("class", "axis-label")
        .text("Average Points Per Game");

      function drawBarChart(filteredData) {
        const teamAverages = d3.rollups(
          filteredData,
          v => d3.mean(v, d => d.PPG),
          d => d.Team
        ).map(([Team, AvgPPG]) => ({Team, AvgPPG}));

        xBar.domain(teamAverages.map(d => d.Team));
        yBar.domain([0, d3.max(teamAverages, d => d.AvgPPG)]);

        xAxisBar.call(d3.axisBottom(xBar));
        yAxisBar.call(d3.axisLeft(yBar));

        const bars = svg2.selectAll("rect")
          .data(teamAverages, d => d.Team);

        bars.join(
          enter => enter.append("rect")
            .attr("x", d => xBar(d.Team))
            .attr("y", yBar(0))
            .attr("width", xBar.bandwidth())
            .attr("height", 0)
            .attr("fill", d => color(d.Team))
            .transition().duration(800)
            .attr("y", d => yBar(d.AvgPPG))
            .attr("height", d => height / 1.5 - yBar(d.AvgPPG)),

          update => update.transition().duration(800)
            .attr("x", d => xBar(d.Team))
            .attr("y", d => yBar(d.AvgPPG))
            .attr("width", xBar.bandwidth())
            .attr("height", d => height / 1.5 - yBar(d.AvgPPG)),

          exit => exit.transition().duration(500)
            .attr("height", 0)
            .remove()
        );
      }

      drawBarChart(data); // Initial load

      // ---------------- INTERACTIVITY ----------------
      function updateCharts(filteredData) {
        // Update bubble chart
        const u = svg1.selectAll("circle").data(filteredData, d => d.Player);

        u.join(
          enter => enter.append("circle")
            .attr("cx", d => xScale(d.PPG))
            .attr("cy", yScale(0))
            .attr("r", 0)
            .attr("fill", d => color(d.Team))
            .attr("opacity", 0.8)
            .transition()
            .duration(800)
            .attr("cy", d => yScale(d.FGP))
            .attr("r", d => d.APG * 1.5),

          update => update.transition().duration(800)
            .attr("cx", d => xScale(d.PPG))
            .attr("cy", d => yScale(d.FGP))
            .attr("r", d => d.APG * 1.5),

          exit => exit.transition().duration(500).attr("r", 0).remove()
        );

        // Update bar chart
        drawBarChart(filteredData);
      }

      // Dropdown + Reset
      d3.select("#teamSelect").on("change", function() {
        const selected = this.value;
        const filtered = selected === "All" ? data : data.filter(d => d.Team === selected);
        updateCharts(filtered);
      });

      d3.select("#resetBtn").on("click", () => {
        d3.select("#teamSelect").property("value", "All");
        updateCharts(data);
      });
    });
  </script>

  <!-- Footer with Documentation + Video -->
  <footer style="margin-top: 60px; text-align: center; padding: 20px; border-top: 1px solid #ccc;">
    <h3>ğŸ€ Final Project Resources</h3>
    <p>
      <a href="https://docs.google.com/document/d/14Sc1YMw1iNSdUsWxriN_acQF3azPcj37ASPVm0D9ZxY/edit?usp=sharing"
         target="_blank" style="font-weight: bold; color: #1d428a; text-decoration: none;">
         ğŸ“„ View Documentation Page
      </a>
    </p>
    <p>
      <a href="https://www.youtube.com/watch?v=YOUR_VIDEO_ID_HERE"
         target="_blank" style="font-weight: bold; color: #e53935; text-decoration: none;">
         ğŸ¥ Watch Demonstration Video
      </a>
    </p>
  </footer>
</body>
</html>
